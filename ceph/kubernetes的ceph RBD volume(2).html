kubernetes的ceph RBD volume(2): 使用Ceph RBD作为persistent volume<br/><br/><div class="article_content tracking-ad" data-dsm="post" data-mod="popu_307" id="article_content">

<p>以下是使用ceph RBD作为persistent volume的例子：<br/>
</p>
<p></p>
<p>A <code class="highlighter-rouge">PersistentVolume</code> (PV) is a piece of networked storage in the cluster that has been provisioned by an administrator. It is a resource in the cluster just like a node is a cluster resource. PVs are volume plugins like
 Volumes, but have a lifecycle independent of any individual pod that uses the PV. This API object captures the details of the implementation of the storage, be that NFS, iSCSI, or a cloud-provider-specific storage system.</p>
<p>A <code class="highlighter-rouge">PersistentVolumeClaim</code> (PVC) is a request for storage by a user. It is similar to a pod. Pods consume node resources and PVCs consume PV resources. Pods can request specific levels of resources (CPU and Memory). Claims
 can request specific size and access modes (e.g., can be mounted once read/write or many times read-only).</p>
<p>1. 先创建image在pool里。</p>
<p>2. 创建 PV<br/>
</p>
<p>[root@testnew kube]# cat pv_ceph.yaml<br/>
apiVersion: v1<br/>
kind: PersistentVolume<br/>
metadata:<br/>
02 name: ceph-pv<br/>
spec:<br/>
02 capacity:<br/>
020202 storage: 50Gi<br/>
02 accessModes:<br/>
020202 - ReadWriteOnce<br/>
02 rbd:<br/>
020202 monitors:<br/>
02020202 - 10.0.200.11:6789<br/>
02020202 - 10.0.200.13:6789<br/>
02020202 - 10.0.200.14:6789<br/>
020202 pool: kube<br/>
020202 image: vol2<br/>
020202 user: kube<br/>
020202 secretRef:<br/>
0202020202 name: ceph-secret<br/>
020202 fsType: ext4<br/>
020202 readOnly: false<br/>
02 persistentVolumeReclaimPolicy: Recycle</p>
<p>kubectl create -f pv_ceph.yaml</p>
<p>[root@testnew kube]# kubectl get pv<br/>
NAME0202020202020202020202020202020202020202020202020202020202020202020202020202 CAPACITY0202 ACCESSMODES0202 RECLAIMPOLICY0202 STATUS020202 CLAIM020202020202020202020202020202020202 REASON020202 AGE<br/>
ceph-pv0202020202020202020202020202020202020202020202020202020202020202020202 50Gi020202020202 RWO02020202020202020202 Recycle0202020202020202 Bound02020202 default/ceph-claim020202020202020202020202020202 4d<br/>
pvc-ac668f99-3b8b-11e7-8af9-fa163e01317b0202 20Gi020202020202 RWO02020202020202020202 Delete020202020202020202 Bound02020202 default/ceph-claim-sc020202020202020202020202 4d<br/>
<br/>
</p>
<p>3.02 创建pvc<br/>
</p>
<p>[root@testnew kube]# cat pvc_ceph.yaml <br/>
kind: PersistentVolumeClaim<br/>
apiVersion: v1<br/>
metadata:<br/>
02 name: ceph-claim<br/>
spec:<br/>
02 accessModes:<br/>
020202 - ReadWriteOnce<br/>
02 resources:<br/>
020202 requests:<br/>
0202020202 storage: 20Gi</p>
<p>note: pvc和pv是一一对应的，所以storage在这设20G没用<br/>
</p>
<p>kubectl create -f pvc_ceph.yaml<br/>
</p>
<p>[root@testnew kube]# kubectl get pvc<br/>
NAME0202020202020202020202 STATUS020202 VOLUME020202020202020202020202020202020202020202020202020202020202020202020202 CAPACITY0202 ACCESSMODES0202 AGE<br/>
ceph-claim0202020202 Bound02020202 ceph-pv0202020202020202020202020202020202020202020202020202020202020202020202 50Gi020202020202 RWO02020202020202020202 4d<br/>
<br/>
4. 创建pod</p>
<p>[root@testnew kube]# cat frontend-pvc-controller.yaml <br/>
apiVersion: v1<br/>
kind: ReplicationController<br/>
metadata:<br/>
02 name: frontendpvc<br/>
02 labels:<br/>
020202 name: frontendpvc<br/>
spec:<br/>
02 replicas: 1<br/>
02 selector:<br/>
020202 name: frontendpvc<br/>
02 template:<br/>
020202 metadata:<br/>
0202020202 labels:<br/>
02020202020202 name: frontendpvc<br/>
020202 spec:<br/>
0202020202 containers:<br/>
0202020202 - name: frontendpvc<br/>
02020202020202 image: kubeguide/guestbook-php-frontend<br/>
02020202020202 env:<br/>
02020202020202 - name: GET_HOSTS_FROM<br/>
020202020202020202 value: env<br/>
02020202020202 ports:<br/>
02020202020202 - containerPort: 80<br/>
02020202020202 volumeMounts:<br/>
02020202020202 - mountPath: /mnt/rbd<br/>
020202020202020202 name: ceph-vol<br/>
0202020202 volumes:<br/>
0202020202 - name: ceph-vol<br/>
02020202020202 persistentVolumeClaim:<br/>
020202020202020202 claimName: ceph-claim<br/>
<br/>
<br/>
</p>
<p><br/>
</p>
   
</div>